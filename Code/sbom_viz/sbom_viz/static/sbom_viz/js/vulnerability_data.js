let fetchedData = null; // try and save the data for later use to save time

export async function getVulnerabilityData(){
    
    if (fetchedData != null)
        return Promise.resolve(fetchedData);
           
    const response = await fetch("http://127.0.0.1:8000/sec-info/");
    const json = await response.json();

    return json.Summary;
}

export async function getVulnerabilityTableData(){
    const json = await getVulnerabilityData();
    const processedData = Object.keys(json.Top_10).map(key => {
        const item = json.Top_10[key];
        return {
            component_name: item.SBOM_ID,
            cve_id: key,
            score: item.Displayed_CVSS,
            severity: item.Severity,
            description: item.Description
        };
    });
    return processedData;
}

export async function getVulnerabilityDistribution(){
    const json = await getVulnerabilityData();
    return json.SeverityDistr;
}

fetchedData = getVulnerabilityData();